<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>

<button id="btn"><a class="a-btn">click</a></button>
<a id="fe" href=""></a>
<script>
    /*框架声明*/
    var main = function(){

    };
    main.event = main.prototype = {
        pool:[],
        onOld:function(types,fn,dom,delegateDom){
            dom || (dom = document);
            delegateDom || (delegateDom = document);
            var func = function(e){
                console.log(e)
               var i = 0,len = e.path.length;

                for(;i<len;i++){
                    if(e.path[i].contains(dom)){
                        e.currentTarget = e.path[i];
                        fn.call(e.path[i],e);
                        break;
                    }
                }
            };
            delegateDom.addEventListener(types,func,false);
            this.pool.push([types,func,delegateDom]);
            return this;
        },
        getDom:function(selector){
            var domList = [],
                res = document.querySelectorAll(selector),
                i= 0,
                len = res.length;
            for(;i<len;i++){
                domList.push(res[i]);
            }
            return domList;
        },
        on:function(types,fn,selector,delegateSelector){
            selector || (selector = "document");
            delegateSelector || (delegateSelector = "document");
            var func = function(e){
                var cur = e.target;
                while(cur != this){
                    if(("."+cur.className == selector) || (cur.localName == selector) || ("#"+cur.id == selector)){
                        fn.call(cur,e);
                    }
                    cur = cur.parentNode;
                }
            };
            var deleDoms = this.getDom(delegateSelector),
                len = deleDoms.length,
                i = 0;
            for(;i<len;i++){
                deleDoms[i].addEventListener(types,func,false);
                this.pool.push([types,func,deleDoms[i]]);
            }
            return this;
        },
        off:function(types,fn,dom){
            dom || (dom = document);
            dom.removeEventListener(types,fn,false);
            return this;
        },
        triggerNew:function(type,dom){

        },
        trigger:function(types,dom){
            dom || (dom = document);
            var event = document.createEvent("HTMLEvents");
            event.initEvent(types,true,true);
            dom.dispatchEvent(event);
            return this;
        }
    };
    main.fn = {
        each:function(){},
        get:function(attr){return this.opts[attr]||"";},
        set:function(){},
        show:function(){},
        hide:function(){},
        destroy:function(){
            var i= 0,me=this,len = me.pool.length,p;
            me.pool.forEach(function(item){
                me.off(item[0],item[1],item[2]);
            });
            for(p in me){
                delete  me[p];
            }
            return this;
        },
        addClass:function(dom,cls){
            var clsName = dom.className,
                    reg = new RegExp("^\\s*"+cls+"\\s+|"+"\\s+"+cls+"\\s+"+"|"+"\\s+"+cls+"\\s*$"+"|^"+cls+"$");
            if(reg.test(clsName)){
                return this;
            }
            dom.className = clsName+" "+cls;
            return this;
        },
        removeClass:function(dom,cls){
            var clsName = dom.className,
                    reg = new RegExp("^\\s*"+cls+"\\s+|"+"\\s+"+cls+"\\s+"+"|"+"\\s+"+cls+"\\s*$"+"|^"+cls+"$","g");

            dom.className = clsName.replace(reg," ");
            return this;
        },
        is:function(dom,targetDom){
            
        }
    };
    main.extend = function(target,obj,deep){  //target类型为{},obj类型为{}或[]
        var i = 0,
            key,
            type = window.Object.prototype.toString.call(obj);
        if(/Object/.test(type)){
            if(deep){
                for(key in obj){
                    target[key] = obj[key];
                }
            }
            else{
                for(key in obj){
                    if(!target.hasOwnProperty(key)){
                        target[key] = obj[key] ;
                    }
                }
            }
        }
        else if(/Array|NodeList/.test(type)){
            var len = obj.length;
            if(deep){
                for(;i<len;i++){
                    target[i] = obj[i];
                }
            }
            else{
                for(;i<len;i++){
                    if(!target.hasOwnProperty(i+"")){
                        target[i] = obj[i] ;
                    }
                }
            }
        }

    };
    main.extend(main.prototype,main.fn);


    main.register = function(name,fn,argvs){
        var me = this;
        main[name] = fn.call(me,argvs) ;
        main[name].prototype.superclass = new main();
        main.extend(main[name].prototype,main.prototype);
    };
    /*框架声明 end*/



    /*注册模块*/
    main.register("test",function(plugins){
        var test = function(){
            var defaults = {
                width:100,
                height:200
            };
            this.opts = defaults;
//            console.log(this.superClass.get.call(this,"width"));
            this.init();
        };

        test.prototype = {
            init:function(){
                var btn = document.getElementById("btn");
                this.on("click",function(e){
                    console.log(1)
                },"a","#btn");
            },
            get:function(){},
            fire:function(){
                var btn = document.getElementById("btn");
                this.trigger("click",btn);
            },
            unbind:function(){
                var btn = document.getElementById("btn");
                this.off("click",null,btn);
            }
        };

        return test;
    });
    var res = new main.test();
    var li = document.createElement("li"),
        body = document.getElementsByTagName("body")[0];
    li.innerText = "123456";
    body.appendChild(li)
</script>
</body>
</html>